---
import { CreateRoom } from "../components/CreateRoom";
import { Login } from "../components/Login";
import { SignUp } from "../components/SignUp";
import { ViewPosts } from "../components/ViewPosts";

const currentUserId = Astro.locals.pb.authStore.model?.id;
const userName = Astro.locals.pb.authStore.model?.name;

let rooms = [];

if (currentUserId) {
  rooms = await Astro.locals.pb
    .collection("rooms")
    .getFullList({ expand: "admin" });

  console.dir(rooms, { depth: null });
}

// console.log("got auth store server", pb.authStore);
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Astro</title>
  </head>
  <body>
    <h1>Hello {userName}| {currentUserId}</h1>

    <SignUp client:load />

    <Login client:load />

    <CreateRoom client:load />

    <ViewPosts client:load />

    <hr />

    <h1>Rooms({rooms?.length})</h1>

    {
      rooms?.map((room) => {
        console.log("ðŸš€ ~ rooms?.map ~ room:", room);
        return (
          <div>
            <a href={`/${room.id}`}> {room.roomName}</a> | Room created by
            <code>{room.expand.admin.username}</code>
          </div>
        );
      })
    }
  </body>
</html>
