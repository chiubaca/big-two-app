---
import { CreateRoom } from "../components/GameRoom/CreateRoom";
import { Login } from "../components/Login";
import { SignUp } from "../components/SignUp";
import { ViewPosts } from "../components/ViewPosts";

const currentUserId = Astro.locals.pb.authStore.model?.id;
const userName = Astro.locals.pb.authStore.model?.name;

const rooms = currentUserId
  ? await Astro.locals.pb.collection("rooms").getFullList({ expand: "admin" })
  : [];

console.dir({ "ðŸš€ rooms on home page": rooms }, { depth: null });
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Astro</title>
  </head>
  <body>
    <h1>Hello {userName}| {currentUserId}</h1>

    <SignUp client:load />

    <Login client:load />

    <CreateRoom client:load />

    <ViewPosts client:load />

    <hr />

    <h1>Rooms({rooms?.length})</h1>

    {
      rooms?.map((room) => {
        return (
          <div>
            <a href={`/${room.id}`}> {room.roomName}</a> | Room created by
            <code>{room.expand.admin.username}</code>
          </div>
        );
      })
    }
  </body>
</html>
